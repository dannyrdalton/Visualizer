<div data-role="header" data-theme="c">
	<h1 class="visualizerName"><%= name %></h1>
	<a href="#" data-role="button" data-rel="back" data-icon="arrow-l">Back</a>
</div>

<div data-role="content" role="main" data-theme="c">
	<div id="input-wrapper">
		<p>Tap the screen to the beat!</p>
		<div class="full-screen-overlay">
			YOU SHOULD NOT SEE THIS
		</div>

		<div class="color-slider">
			<div class="color-indicator"></div>
			<input type="range" name="slider" id="slider-1" value="0" min="0" max="1536"  />
		</div>
	</div>
</div>


<script type="text/javascript">
	var debug = 0;
	var type = "circles";
	
	$('.color-indicator').hide();
	
	var name = $('.visualizerName').html();
	$('.full-screen-overlay').height($(this).height() - 46);
	
	var pusher = new Pusher('1c0d1fc18d1af207286e');
	var presenceChannel = pusher.subscribe('presence-' + name);
	
/*
	channel.bind('new-price', function(data) {
	    // add new price into the APPL widget
	});
*/
	var socketID = null;
	pusher.connection.bind('connected', function() {
		socketID = pusher.connection.socket_id;
		
	});

	var color = "#ff0000";
	$('.ui-slider-handle').css('background-color', color);
	
	function componentToHex(c) {
    	var hex = c.toString(16);
    	return hex.length == 1 ? "0" + hex : hex;
	}

	function rgbToHex(r, g, b) {
    	return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
	}
	
	var date;
	$('.full-screen-overlay').bind('tap', function(e) {
		date = new Date();
		var x, y;
		if(e.touches) {
			var touch = e.touches[0];
			x = touch.pageX;
			y = touch.pageY;
		}
		else {
			x = e.pageX;
			y = e.pageY;
		}
		var xPos = x / $(window).height();
		var yPos = y / $(window).height();
		presenceChannel.trigger('client-tapped', { id : presenceChannel.members.me.id, color : color, xPos : xPos, yPos : yPos, timestamp : date.getTime() } );
	});
	
	$(".color-slider").change(function() {
    	var sVal = $('#slider-1').val();
/*     	console.log("Sval is %i", sVal); */
    	if (sVal >= 0 && sVal < 256) {
    		color = rgbToHex(255, sVal, 0);
    	}
    	if (sVal >= 256 && sVal < 512) {
    		color = rgbToHex(255 - (sVal - 256), 255, 0);
    	}
    	if (sVal >= 512 && sVal < 768) {
    		color = rgbToHex(0, 255, sVal - 512);
    	}
    	if (sVal >= 768 && sVal < 1024) {
    		color = rgbToHex(0, 255 - (sVal - 768), 255);
    	}
    	if (sVal >= 1024 && sVal < 1280) {
    		color = rgbToHex(sVal - 1024, 0, 255);
    	}
    	if (sVal >= 1280 && sVal < 1536) {
    		color = rgbToHex(255, 0, 255 - (sVal - 1280));
    	}
    	var indicatorPosition = $('.ui-slider-handle').position().left + 14;
    	$(".color-indicator").show().css({'background-color' : color, left : indicatorPosition });
/*     	console.log($('.ui-slider-handle').position()); */
    	
    	$('.ui-slider-handle').css('background-color', color);
    	
    });
    
    $( ".color-slider" ).on( 'slidestop', function( event ) { $(".color-indicator").hide() });

</script>